<!-- Se√ß√£o de Pares para adicionar ao index.html -->

<div id="pairsSection" style="margin-top: 40px; padding: 20px; background: #f9f9f9; border-radius: 8px;">
    <h2>üìä Status dos Pares BUY/SELL</h2>
    
    <div style="margin: 20px 0; padding: 15px; background: white; border-radius: 6px;">
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
            <div style="padding: 15px; background: #e8f5e9; border-radius: 6px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold;" id="totalPairs">0</div>
                <div style="font-size: 12px; color: #666;">Total Pares</div>
            </div>
            <div style="padding: 15px; background: #c8e6c9; border-radius: 6px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #2e7d32;" id="completePairs">0</div>
                <div style="font-size: 12px; color: #666;">Completos ‚úÖ</div>
            </div>
            <div style="padding: 15px; background: #fff9c4; border-radius: 6px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #f57f17;" id="incompletePairs">0</div>
                <div style="font-size: 12px; color: #666;">Incompletos ‚è≥</div>
            </div>
            <div style="padding: 15px; background: #e0f2f1; border-radius: 6px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #00695c;" id="avgROI">0%</div>
                <div style="font-size: 12px; color: #666;">ROI M√©dio</div>
            </div>
        </div>
    </div>

    <div style="max-height: 500px; overflow-y: auto; border: 1px solid #ddd; border-radius: 6px;">
        <table id="pairsTable" style="width: 100%; border-collapse: collapse; font-size: 12px;">
            <thead style="background: #f5f5f5; position: sticky; top: 0;">
                <tr>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Pair ID</th>
                    <th style="padding: 10px; text-align: center; border-bottom: 2px solid #ddd;">Status</th>
                    <th style="padding: 10px; text-align: right; border-bottom: 2px solid #ddd;">BUY (ID | Pre√ßo)</th>
                    <th style="padding: 10px; text-align: right; border-bottom: 2px solid #ddd;">SELL (ID | Pre√ßo)</th>
                    <th style="padding: 10px; text-align: right; border-bottom: 2px solid #ddd;">Spread</th>
                    <th style="padding: 10px; text-align: right; border-bottom: 2px solid #ddd;">ROI L√≠quido</th>
                </tr>
            </thead>
            <tbody id="pairsBody">
                <tr>
                    <td colspan="6" style="padding: 20px; text-align: center; color: #999;">
                        Carregando pares...
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<style>
    #pairsTable tr:hover {
        background: #f0f0f0;
    }
    
    #pairsTable tr:nth-child(even) {
        background: #fafafa;
    }
    
    .pair-status-complete {
        background: #c8e6c9;
        color: #2e7d32;
        padding: 4px 8px;
        border-radius: 4px;
        font-weight: bold;
        font-size: 11px;
    }
    
    .pair-status-incomplete {
        background: #fff9c4;
        color: #f57f17;
        padding: 4px 8px;
        border-radius: 4px;
        font-weight: bold;
        font-size: 11px;
    }
    
    .pair-id {
        font-family: monospace;
        font-size: 11px;
        color: #666;
    }
</style>

<script>
    async function loadPairs() {
        try {
            const response = await fetch('/api/pairs');
            const data = await response.json();
            
            document.getElementById('totalPairs').textContent = data.totalPairs;
            document.getElementById('completePairs').textContent = data.completePairs;
            document.getElementById('incompletePairs').textContent = data.incompletePairs;
            
            // Calcular ROI m√©dio
            let avgROI = 0;
            if (data.completePairs > 0) {
                let totalROI = 0;
                for (const pair of data.pairs) {
                    if (pair.status === 'COMPLETO') {
                        const roi = parseFloat(pair.roi) || 0;
                        totalROI += roi;
                    }
                }
                avgROI = (totalROI / data.completePairs).toFixed(2);
            }
            document.getElementById('avgROI').textContent = avgROI + '%';
            
            // Popular tabela
            const tbody = document.getElementById('pairsBody');
            tbody.innerHTML = '';
            
            if (data.pairs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="padding: 20px; text-align: center; color: #999;">Nenhum par aberto no momento</td></tr>';
                return;
            }
            
            for (const pair of data.pairs) {
                const row = document.createElement('tr');
                const statusClass = pair.status === 'COMPLETO' ? 'pair-status-complete' : 'pair-status-incomplete';
                const statusText = pair.status === 'COMPLETO' ? '‚úÖ COMPLETO' : 
                                   (pair.status === 'AGUARDANDO_SELL' ? '‚è≥ AGUARDANDO SELL' : '‚è≥ AGUARDANDO BUY');
                
                row.innerHTML = `
                    <td style="padding: 10px;">
                        <span class="pair-id">${pair.pairId}</span>
                    </td>
                    <td style="padding: 10px; text-align: center;">
                        <span class="${statusClass}">${statusText}</span>
                    </td>
                    <td style="padding: 10px; text-align: right;">
                        ${pair.buyOrder ? `<span style="color: #2e7d32;">‚úì ${pair.buyOrder.id}<br/>R$ ${pair.buyOrder.price}</span>` : '<span style="color: #ccc;">-</span>'}
                    </td>
                    <td style="padding: 10px; text-align: right;">
                        ${pair.sellOrder ? `<span style="color: #c62828;">‚úì ${pair.sellOrder.id}<br/>R$ ${pair.sellOrder.price}</span>` : '<span style="color: #ccc;">-</span>'}
                    </td>
                    <td style="padding: 10px; text-align: right; font-weight: bold;">
                        ${pair.spread}
                    </td>
                    <td style="padding: 10px; text-align: right;">
                        <span style="color: ${parseFloat(pair.roi) > 0 ? '#2e7d32' : '#c62828'}; font-weight: bold;">
                            ${pair.roi}
                        </span>
                    </td>
                </tr>
            `;
            tbody.appendChild(row);
        }
        } catch (err) {
            console.error('Erro ao carregar pares:', err);
            document.getElementById('pairsBody').innerHTML = `
                <tr>
                    <td colspan="6" style="padding: 20px; text-align: center; color: #c62828;">
                        Erro ao carregar pares: ${err.message}
                    </td>
                </tr>
            `;
        }
    }
    
    // Carregar pares inicialmente e a cada 10 segundos
    loadPairs();
    setInterval(loadPairs, 10000);
</script>
